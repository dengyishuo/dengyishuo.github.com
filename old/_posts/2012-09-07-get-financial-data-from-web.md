---
layout: post
title: 获取上市公司主要财务指标
comments: true
categories:
- R
tags:
- 抓数据
- 财务指标
- R
- 排名系统
---
  
写了一段获取上市公司主要财务指标的代码：
{% highlight r %}
####需要载入XML包
####id:股票代码
####year:年度

get.finance=function(id,year){
web=paste("http://money.finance.sina.com.cn/corp/go.php/vFD_FinancialGuideLine/stockid/",id,"/ctrl/",year,"/displaytype/4.phtml",sep="")
tables <- readHTMLTable(web)[[20]]
rownames(tables)<-iconv(tables[,1],"UTF-8","gbk")
return(tables[,-1])
}
{% endhighlight %}


简单演示一下：
{% highlight r %}
> library(XML)
> source("get.finance.r")
> get.finance("000002","2012")
?????????????????????????????????????????????????????????????????????????????????????????? NA?????????????????????? NA.1
报告日期?????????????????????????????????????????????????????????? 2012-06-30?????????? 2012-03-31
每股指标?????????????????????????????????????????????????????????????????????? <NA>?????????????????????? <NA>
摊薄每股收益(元)?????????????????????????????????????????????????? 0.4125?????????????????? 0.1392
加权每股收益(元)?????????????????????????????????????????????????????? 0.34?????????????????????? 0.13
每股收益_调整后(元)???????????????????????????????????????????????? 0.34?????????????????????? 0.13
扣除非经常性损益后的每股收益(元)?????????????????????? 0.33?????????????????????????? --
每股净资产_调整前(元)???????????????????????????????????????? 6.3513?????????????????? 6.2864
每股净资产_调整后(元)???????????????????????????????????????????? 5.01?????????????????????? 4.94
每股经营性现金流(元)?????????????????????????????????????????? 0.2564?????????????????? 0.1164
每股资本公积金(元)?????????????????????????????????????????????? 0.7961?????????????????? 0.8074
每股未分配利润(元)?????????????????????????????????????????????? 1.9309???????????????????? 1.849
调整后的每股净资产(元)?????????????????????????????????????????????? --?????????????????????????? --
盈利能力?????????????????????????????????????????????????????????????????????? <NA>?????????????????????? <NA>
总资产利润率(%)???????????????????????????????????????????????????? 1.3727???????????????????? 0.493
主营业务利润率(%)?????????????????????????????????????????????? 26.5204???????????????? 30.7098
总资产净利润率(%)???????????????????????????????????????????????? 1.4476?????????????????? 0.5046
成本费用利润率(%)?????????????????????????????????????????????? 24.1165???????????????? 24.5405
营业利润率(%)?????????????????????????????????????????????????????? 19.5695???????????????? 19.6879
主营业务成本率(%)?????????????????????????????????????????????? 62.7362???????????????? 58.2094
销售净利率(%)?????????????????????????????????????????????????????? 14.7625???????????????? 14.7937
股本报酬率(%)?????????????????????????????????????????????????????? 46.4971???????????????? 13.9201
净资产报酬率(%)???????????????????????????????????????????????????? 7.3209?????????????????? 2.2143
资产报酬率(%)???????????????????????????????????????????????????????? 1.5473???????????????????? 0.493
销售毛利率(%)?????????????????????????????????????????????????????? 37.2638???????????????? 41.7906
三项费用比重?????????????????????????????????????????????????????????? 8.1564???????????????? 11.7728
非主营比重?????????????????????????????????????????????????????????????? 8.4199?????????????????? 7.1215
主营利润比重???????????????????????????????????????????????????????? 134.705?????????????? 154.3725
股息发放率(%)???????????????????????????????????????????????????????? 0.4519?????????????????????????? --
投资收益率(%)???????????????????????????????????????????????????????????????? --?????????????????????????? --
主营业务利润(元)???????????????????????????????????? 8147863737.68???? 3177205988.65
净资产收益率(%)???????????????????????????????????????????????????????? 6.76?????????????????????? 2.57
加权净资产收益率(%)???????????????????????????????????????????????? 6.83???????????????????????? 2.6
扣除非经常性损益后的净利润(元)???????? 3680771877.92?????????????????????????? --
成长能力?????????????????????????????????????????????????????????????????????? <NA>?????????????????????? <NA>
主营业务收入增长率(%)?????????????????????????????????????? 53.7007???????????????? 29.8065
净利润增长率(%)?????????????????????????????????????????????????? 39.4451???????????????? 28.6212
净资产增长率(%)?????????????????????????????????????????????????? 20.8044???????????????? 23.1456
总资产增长率(%)?????????????????????????????????????????????????? 26.6098???????????????? 31.8992
营运能力?????????????????????????????????????????????????????????????????????? <NA>?????????????????????? <NA>
应收账款周转率(次)?????????????????????????????????????????????? 23.141?????????????????? 7.4727
应收账款周转天数(天)???????????????????????????????????????? 15.5568???????????????? 48.1754
存货周转天数(天)???????????????????????????????????????????? 4058.6246?????????? 12631.5789
存货周转率(次)?????????????????????????????????????????????????????? 0.0887?????????????????? 0.0285
固定资产周转率(次)???????????????????????????????????????????? 19.4307?????????????????????????? --
总资产周转率(次)?????????????????????????????????????????????????? 0.0981?????????????????? 0.0341
总资产周转天数(天)???????????????????????????????????????? 3669.7248?????????? 10557.1848
流动资产周转率(次)?????????????????????????????????????????????? 0.1026?????????????????? 0.0357
流动资产周转天数(天)???????????????????????????????????? 3508.7719?????????? 10084.0336
股东权益周转率(次)?????????????????????????????????????????????? 0.4463?????????????????? 0.1511
偿债及资本结构?????????????????????????????????????????????????????????? <NA>?????????????????????? <NA>
流动比率?????????????????????????????????????????????????????????????????? 1.4567???????????????????? 1.459
速动比率???????????????????????????????????????????????????????????????????? 0.414?????????????????? 0.4032
现金比率(%)?????????????????????????????????????????????????????????? 21.6545???????????????? 19.2057
利息支付倍数???????????????????????????????????????????????????? 1527.5417???????????? 1691.6203
长期债务与营运资金比率(%)???????????????????????????????? 0.3706?????????????????? 0.3349
股东权益比率(%)?????????????????????????????????????????????????? 21.1361???????????????? 22.2657
长期负债比率(%)?????????????????????????????????????????????????? 11.1198???????????????? 10.0697
股东权益与固定资产比率(%)?????????????????????????? 4458.0873?????????????????????????? --
负债与所有者权益比率(%)???????????????????????????????? 373.1238?????????????? 349.1223
长期资产与长期资金比率(%)?????????????????????????????? 13.2857???????????????? 13.6933
资本化比率(%)?????????????????????????????????????????????????????? 34.4736???????????????? 31.1415
固定资产净值率(%)?????????????????????????????????????????????? 73.0815?????????????????????????? --
资本固定化比率(%)?????????????????????????????????????????????? 20.2753???????????????? 19.8862
产权比率(%)?????????????????????????????????????????????????????????? 363.492???????????????? 339.418
清算价值比率(%)???????????????????????????????????????????????? 129.9783?????????????? 132.1361
固定资产比重(%)???????????????????????????????????????????????????? 0.4741?????????????????????????? --
资产负债率(%)?????????????????????????????????????????????????????? 78.8639???????????????? 77.7343
总资产(元)???????????????????????????????????????????? 330401184008.97 310436504322.24
现金流量?????????????????????????????????????????????????????????????????????? <NA>?????????????????????? <NA>
经营现金净流量对销售收入比率(%)???????????????????? 0.0918?????????????????? 0.1237
资产的经营现金流量回报率(%)???????????????????????????? 0.0085?????????????????? 0.0041
经营现金净流量与净利润的比率(%)???????????????????? 0.6216?????????????????? 0.8364
经营现金净流量对负债比率(%)???????????????????????????? 0.0108?????????????????? 0.0053
现金流量比率(%)???????????????????????????????????????????????????? 1.2986?????????????????? 0.6295
其他指标?????????????????????????????????????????????????????????????????????? <NA>?????????????????????? <NA>
短期股票投资(元)?????????????????????????????????????????????????????????? --?????????????????????????? --
短期债券投资(元)?????????????????????????????????????????????????????????? --?????????????????????????? --
短期其它经营性投资(元)?????????????????????????????????????????????? --?????????????????????????? --
长期股票投资(元)???????????????????????????????????? 6884039487.21???? 6562764306.56
长期债券投资(元)?????????????????????????????????????????????????????????? --?????????????????????????? --
长期其它经营性投资(元)?????????????????????????????????????????????? --?????????????????????????? --
1年以内应收帐款(元)???????????????????????????????????????????????????? --?????????????????????????? --
1-2年以内应收帐款(元)???????????????????????????? 197814947.32?????????????????????????? --
2-3年以内应收帐款(元)?????????????????????????????? 17068451.94?????????????????????????? --
3年以内应收帐款(元)???????????????????????????????????????????????????? --?????????????????????????? --
1年以内预付货款(元)???????????????????????????????????????????????????? --?????????????????????????? --
1-2年以内预付货款(元)?????????????????????????????? 966595641.9?????????????????????????? --
2-3年以内预付货款(元)???????????????????????????? 114623121.59?????????????????????????? --
3年以内预付货款(元)???????????????????????????????????????????????????? --?????????????????????????? --
1年以内其它应收款(元)???????????????????????????????????????????????? --?????????????????????????? --
1-2年以内其它应收款(元)?????????????????????? 3359235018.33?????????????????????????? --
2-3年以内其它应收款(元)?????????????????????? 1195031122.03?????????????????????????? --
3年以内其它应收款(元)???????????????????????????????????????????????? --?????????????????????????? --
{% endhighlight %}
基于这些财务数据和价格数据，就可以着手建立股票排名系统了。